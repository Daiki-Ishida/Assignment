<!DOCTYPE html>
<html>

<head>
  <title>Sample-App</title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>
  <header>
    <p><%= `logged in as ${user.name}` %></p>
    <a href="/">Home</a>
    <button type="button" id="logout" onclick="logout()">Logout</button>
  </header>
  <h1>Global Chat!</h1>

  <div class="chat">
    <ul id="messages"></ul>
    <form action="" class="chat-form">
      <input id="messageInput" placeholder="Please Input Here..." />
      <button type="button" onclick="send()">Send</button>
    </form>
  </div>

  <script>
    const socket = io();
    const messages = document.getElementById('messages');
    const userName = '<%= user.name %>';

    const send = () => {
      const message = document.getElementById('messageInput');
      const data = {
        message: message.value,
        user: userName
      };
      if (message == '') {
        return false;
      }
      socket.emit('req', data);
      message.value = '';
    }

    socket.on('res', (data) => {
      const newMsg = document.createElement("li");
      newMsg.textContent = `${data.user}: ${data.message}`;
      messages.appendChild(newMsg);
    })

    function logout(e) {
      confirm('ログアウトしますか？');
      const form = document.createElement('form');
      form.action = "/logout";
      form.method = 'post';
      document.body.appendChild(form);
      form.submit();
    }
  </script>
</body>

</html>